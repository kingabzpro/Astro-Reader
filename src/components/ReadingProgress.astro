---
interface Props {
  bookId: string;
  chapterId: string;
}

const { bookId, chapterId } = Astro.props;
---

<div id="reading-progress"></div>

<script define:vars={{ bookId, chapterId }}>
  console.log('[Progress] Starting:', bookId, chapterId);
  
  async function save() {
    try {
      const res = await fetch('/api/progress', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ bookId, chapterId }),
      });
      console.log('[Progress] Result:', res.status);
    } catch (e) {
      console.error('[Progress] Error:', e);
    }
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', save);
  } else {
    save();
  }
</script>
